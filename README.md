# Delegate AWS console access through a temporary link

Generate a temporary link that allows you to delegate temporary access to anybody to assume an IAM role in your AWS account and access the AWS web console, without having to create IAM users for them and without having to deal with AWS Organizations.

---

This mini-app is actually an "easy to deploy" AWS CDK app. Basic instructions of use:

1. `npm install`
2. `npm run cdk deploy`. Look for the stack output. This should give you the ARN of the Lambda that generates temporary link
3. Enjoy. You can invoke the Lambda locally, hide it behind an API gateway or integrate it otherwise integrate it with your application.

Here's an example on how to generate a temporary link:

```
FUNCTION_ARN="arn:aws:lambda:eu-west-1:742958482180:function:CreateAwsConsoleLinkStack-lambda8B5974B5-19SOZWAQ3E1WB"
aws lambda invoke --function-name $FUNCTION_ARN --payload '{}' response.json
cat response.json | jq --raw-output '.link'
```

The TypeScript class included, works with the following input parameters:
* AWS access key and secret access key - generated by an IAM user who has enough permissions to assume the Role himself
* Role ARN - the role that will be transparently assumed by the person who visits the link
* Role Session Name (optional) - an alias that you can use to identify the person, for whom the link was generated. This can be the name of the person or the name of the system that generated the link for example. Useful to keep track of actions taken inside CloudTrail.

> NOTE: The first two keys must be "long term" credentials, created by the IAM user. Temporary credentials, created by STS or ones, provided to an assumed role (e.g. Lambda executioner role or EC2 metadata service) will not work!

By using this utility class, you will be able to generate a HTTP link that you can provide to anyone to use, as long as they visit it within 15 minutes of generating (security restriction). The visitor of the link will be able to manage resources, based on the permissions from the assumed role - for the next 12 hours (this will be configurable in a future version).

Internally, this tool relies on the https://signin.aws.amazon.com/federation endpoint and AWS STS.

---

### Usage

1. Create an IAM Role (e.g. "DevOps Team") that you want users to automatically assume, when they visit the link. Feel free to give any permissions you want to this role, depending on the use case (e.g. EC2, VPC management, etc). Take note of the `Role ARN`.
2. Create an IAM User (e.g. "service-user--console-links-creator") that will assume the above role and delegate this access to people using the temporary link.
3. Allow the IAM User to assume the Role by defining him in the `Principal` section of the Role and allow the `sts:AssumeRole` action in any of this user's IAM policies.
4. Create a set of long-term IAM credentials for the above user using the AWS console or CLI (`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`).

Install this package and import it in your TypeScript code, using the example below:

    // Will be logged in CloudTrail along with all actions taken
    const userAlias = "MikeFromDevOpsTeam";
    
    // Generate the HTTP link
    const link = await new ConsoleSigninGenerator(
       AWS_ACCESS_KEY_ID,
       AWS_SECRET_ACCESS_KEY,
       roleToAssumeARN,
       userAlias
    ).getConsoleSigninLink();
    
    console.log(link);

A more detailed example that showcases all aspects of the steps described, is available as an AWS CDK stack in the /examples/cdk folder.
